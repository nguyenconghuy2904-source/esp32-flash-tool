(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[528],{737:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AmpStateContext",{enumerable:!0,get:function(){return r}});let r=i(8140)._(i(2115)).default.createContext({})},821:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),!function(t,e){for(var i in e)Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}(e,{VALID_LOADERS:function(){return i},imageConfigDefault:function(){return r}});let i=["default","imgix","cloudinary","akamai","custom"],r={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:void 0,unoptimized:!1}},861:(t,e)=>{"use strict";function i(t){let{ampFirst:e=!1,hybrid:i=!1,hasQuery:r=!1}=void 0===t?{}:t;return e||i&&r}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"isInAmpMode",{enumerable:!0,get:function(){return i}})},1124:(t,e)=>{"use strict";function i(t){var e;let{config:i,src:r,width:s,quality:a}=t,n=a||(null==(e=i.qualities)?void 0:e.reduce((t,e)=>Math.abs(e-75)<Math.abs(t-75)?e:t))||75;return i.path+"?url="+encodeURIComponent(r)+"&w="+s+"&q="+n+(r.startsWith("/_next/static/media/"),"")}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return r}}),i.__next_img_default=!0;let r=i},1262:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return n}});let r=i(2115),s=r.useLayoutEffect,a=r.useEffect;function n(t){let{headManager:e,reduceComponentsToState:i}=t;function n(){if(e&&e.mountedInstances){let s=r.Children.toArray(Array.from(e.mountedInstances).filter(Boolean));e.updateHead(i(s,t))}}return s(()=>{var i;return null==e||null==(i=e.mountedInstances)||i.add(t.children),()=>{var i;null==e||null==(i=e.mountedInstances)||i.delete(t.children)}}),s(()=>(e&&(e._pendingUpdate=n),()=>{e&&(e._pendingUpdate=n)})),a(()=>(e&&e._pendingUpdate&&(e._pendingUpdate(),e._pendingUpdate=null),()=>{e&&e._pendingUpdate&&(e._pendingUpdate(),e._pendingUpdate=null)})),null}},1356:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Image",{enumerable:!0,get:function(){return m}});let r=i(8140),s=i(9417),a=i(5155),n=s._(i(2115)),o=r._(i(7650)),h=r._(i(4841)),l=i(5040),d=i(821),c=i(3455);i(4781);let u=i(9862),f=r._(i(1124)),p=i(3011),_={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0};function g(t,e,i,r,s,a,n){let o=null==t?void 0:t.src;t&&t["data-loaded-src"]!==o&&(t["data-loaded-src"]=o,("decode"in t?t.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(t.parentElement&&t.isConnected){if("empty"!==e&&s(!0),null==i?void 0:i.current){let e=new Event("load");Object.defineProperty(e,"target",{writable:!1,value:t});let r=!1,s=!1;i.current({...e,nativeEvent:e,currentTarget:t,target:t,isDefaultPrevented:()=>r,isPropagationStopped:()=>s,persist:()=>{},preventDefault:()=>{r=!0,e.preventDefault()},stopPropagation:()=>{s=!0,e.stopPropagation()}})}(null==r?void 0:r.current)&&r.current(t)}}))}function y(t){return n.use?{fetchPriority:t}:{fetchpriority:t}}let S=(0,n.forwardRef)((t,e)=>{let{src:i,srcSet:r,sizes:s,height:o,width:h,decoding:l,className:d,style:c,fetchPriority:u,placeholder:f,loading:_,unoptimized:S,fill:w,onLoadRef:m,onLoadingCompleteRef:E,setBlurComplete:A,setShowAltText:b,sizesInput:T,onLoad:R,onError:I,...P}=t,v=(0,n.useCallback)(t=>{t&&(I&&(t.src=t.src),t.complete&&g(t,f,m,E,A,S,T))},[i,f,m,E,A,I,S,T]),C=(0,p.useMergedRef)(e,v);return(0,a.jsx)("img",{...P,...y(u),loading:_,width:h,height:o,decoding:l,"data-nimg":w?"fill":"1",className:d,style:c,sizes:s,srcSet:r,src:i,ref:C,onLoad:t=>{g(t.currentTarget,f,m,E,A,S,T)},onError:t=>{b(!0),"empty"!==f&&A(!0),I&&I(t)}})});function w(t){let{isAppRouter:e,imgAttributes:i}=t,r={as:"image",imageSrcSet:i.srcSet,imageSizes:i.sizes,crossOrigin:i.crossOrigin,referrerPolicy:i.referrerPolicy,...y(i.fetchPriority)};return e&&o.default.preload?(o.default.preload(i.src,r),null):(0,a.jsx)(h.default,{children:(0,a.jsx)("link",{rel:"preload",href:i.srcSet?void 0:i.src,...r},"__nimg-"+i.src+i.srcSet+i.sizes)})}let m=(0,n.forwardRef)((t,e)=>{let i=(0,n.useContext)(u.RouterContext),r=(0,n.useContext)(c.ImageConfigContext),s=(0,n.useMemo)(()=>{var t;let e=_||r||d.imageConfigDefault,i=[...e.deviceSizes,...e.imageSizes].sort((t,e)=>t-e),s=e.deviceSizes.sort((t,e)=>t-e),a=null==(t=e.qualities)?void 0:t.sort((t,e)=>t-e);return{...e,allSizes:i,deviceSizes:s,qualities:a}},[r]),{onLoad:o,onLoadingComplete:h}=t,p=(0,n.useRef)(o);(0,n.useEffect)(()=>{p.current=o},[o]);let g=(0,n.useRef)(h);(0,n.useEffect)(()=>{g.current=h},[h]);let[y,m]=(0,n.useState)(!1),[E,A]=(0,n.useState)(!1),{props:b,meta:T}=(0,l.getImgProps)(t,{defaultLoader:f.default,imgConf:s,blurComplete:y,showAltText:E});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S,{...b,unoptimized:T.unoptimized,placeholder:T.placeholder,fill:T.fill,onLoadRef:p,onLoadingCompleteRef:g,setBlurComplete:m,setShowAltText:A,sizesInput:t.sizes,ref:e}),T.priority?(0,a.jsx)(w,{isAppRouter:!i,imgAttributes:b}):null]})});("function"==typeof e.default||"object"==typeof e.default&&null!==e.default)&&void 0===e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},3011:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useMergedRef",{enumerable:!0,get:function(){return s}});let r=i(2115);function s(t,e){let i=(0,r.useRef)(null),s=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let t=i.current;t&&(i.current=null,t());let e=s.current;e&&(s.current=null,e())}else t&&(i.current=a(t,r)),e&&(s.current=a(e,r))},[t,e])}function a(t,e){if("function"!=typeof t)return t.current=e,()=>{t.current=null};{let i=t(e);return"function"==typeof i?i:()=>t(null)}}("function"==typeof e.default||"object"==typeof e.default&&null!==e.default)&&void 0===e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},3455:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"ImageConfigContext",{enumerable:!0,get:function(){return a}});let r=i(8140)._(i(2115)),s=i(821),a=r.default.createContext(s.imageConfigDefault)},4105:(t,e)=>{"use strict";function i(t){let{widthInt:e,heightInt:i,blurWidth:r,blurHeight:s,blurDataURL:a,objectFit:n}=t,o=r?40*r:e,h=s?40*s:i,l=o&&h?"viewBox='0 0 "+o+" "+h+"'":"";return"%3Csvg xmlns='http://www.w3.org/2000/svg' "+l+"%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='"+(l?"none":"contain"===n?"xMidYMid":"cover"===n?"xMidYMid slice":"none")+"' style='filter: url(%23b);' href='"+a+"'/%3E%3C/svg%3E"}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getImageBlurSvg",{enumerable:!0,get:function(){return i}})},4652:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),!function(t,e){for(var i in e)Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}(e,{default:function(){return h},getImageProps:function(){return o}});let r=i(8140),s=i(5040),a=i(1356),n=r._(i(1124));function o(t){let{props:e}=(0,s.getImgProps)(t,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[t,i]of Object.entries(e))void 0===i&&delete e[t];return{props:e}}let h=a.Image},4841:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),!function(t,e){for(var i in e)Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}(e,{default:function(){return _},defaultHead:function(){return c}});let r=i(8140),s=i(9417),a=i(5155),n=s._(i(2115)),o=r._(i(1262)),h=i(737),l=i(2073),d=i(861);function c(t){void 0===t&&(t=!1);let e=[(0,a.jsx)("meta",{charSet:"utf-8"},"charset")];return t||e.push((0,a.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")),e}function u(t,e){return"string"==typeof e||"number"==typeof e?t:e.type===n.default.Fragment?t.concat(n.default.Children.toArray(e.props.children).reduce((t,e)=>"string"==typeof e||"number"==typeof e?t:t.concat(e),[])):t.concat(e)}i(4781);let f=["name","httpEquiv","charSet","itemProp"];function p(t,e){let{inAmpMode:i}=e;return t.reduce(u,[]).reverse().concat(c(i).reverse()).filter(function(){let t=new Set,e=new Set,i=new Set,r={};return s=>{let a=!0,n=!1;if(s.key&&"number"!=typeof s.key&&s.key.indexOf("$")>0){n=!0;let e=s.key.slice(s.key.indexOf("$")+1);t.has(e)?a=!1:t.add(e)}switch(s.type){case"title":case"base":e.has(s.type)?a=!1:e.add(s.type);break;case"meta":for(let t=0,e=f.length;t<e;t++){let e=f[t];if(s.props.hasOwnProperty(e))if("charSet"===e)i.has(e)?a=!1:i.add(e);else{let t=s.props[e],i=r[e]||new Set;("name"!==e||!n)&&i.has(t)?a=!1:(i.add(t),r[e]=i)}}}return a}}()).reverse().map((t,e)=>{let i=t.key||e;return n.default.cloneElement(t,{key:i})})}let _=function(t){let{children:e}=t,i=(0,n.useContext)(h.AmpStateContext),r=(0,n.useContext)(l.HeadManagerContext);return(0,a.jsx)(o.default,{reduceComponentsToState:p,headManager:r,inAmpMode:(0,d.isInAmpMode)(i),children:e})};("function"==typeof e.default||"object"==typeof e.default&&null!==e.default)&&void 0===e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},5040:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getImgProps",{enumerable:!0,get:function(){return h}}),i(4781);let r=i(4105),s=i(821),a=["-moz-initial","fill","none","scale-down",void 0];function n(t){return void 0!==t.default}function o(t){return void 0===t?t:"number"==typeof t?Number.isFinite(t)?t:NaN:"string"==typeof t&&/^[0-9]+$/.test(t)?parseInt(t,10):NaN}function h(t,e){var i,h;let l,d,c,{src:u,sizes:f,unoptimized:p=!1,priority:_=!1,loading:g,className:y,quality:S,width:w,height:m,fill:E=!1,style:A,overrideSrc:b,onLoad:T,onLoadingComplete:R,placeholder:I="empty",blurDataURL:P,fetchPriority:v,decoding:C="async",layout:B,objectFit:M,objectPosition:D,lazyBoundary:x,lazyRoot:F,...O}=t,{imgConf:U,showAltText:L,blurComplete:k,defaultLoader:H}=e,j=U||s.imageConfigDefault;if("allSizes"in j)l=j;else{let t=[...j.deviceSizes,...j.imageSizes].sort((t,e)=>t-e),e=j.deviceSizes.sort((t,e)=>t-e),r=null==(i=j.qualities)?void 0:i.sort((t,e)=>t-e);l={...j,allSizes:t,deviceSizes:e,qualities:r}}if(void 0===H)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let N=O.loader||H;delete O.loader,delete O.srcSet;let G="__next_img_default"in N;if(G){if("custom"===l.loader)throw Object.defineProperty(Error('Image with src "'+u+'" is missing "loader" prop.\nRead more: https://nextjs.org/docs/messages/next-image-missing-loader'),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let t=N;N=e=>{let{config:i,...r}=e;return t(r)}}if(B){"fill"===B&&(E=!0);let t={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[B];t&&(A={...A,...t});let e={responsive:"100vw",fill:"100vw"}[B];e&&!f&&(f=e)}let z="",W=o(w),$=o(m);if((h=u)&&"object"==typeof h&&(n(h)||void 0!==h.src)){let t=n(u)?u.default:u;if(!t.src)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received "+JSON.stringify(t)),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!t.height||!t.width)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received "+JSON.stringify(t)),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(d=t.blurWidth,c=t.blurHeight,P=P||t.blurDataURL,z=t.src,!E)if(W||$){if(W&&!$){let e=W/t.width;$=Math.round(t.height*e)}else if(!W&&$){let e=$/t.height;W=Math.round(t.width*e)}}else W=t.width,$=t.height}let Z=!_&&("lazy"===g||void 0===g);(!(u="string"==typeof u?u:z)||u.startsWith("data:")||u.startsWith("blob:"))&&(p=!0,Z=!1),l.unoptimized&&(p=!0),G&&!l.dangerouslyAllowSVG&&u.split("?",1)[0].endsWith(".svg")&&(p=!0);let q=o(S),K=Object.assign(E?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:M,objectPosition:D}:{},L?{}:{color:"transparent"},A),J=k||"empty"===I?null:"blur"===I?'url("data:image/svg+xml;charset=utf-8,'+(0,r.getImageBlurSvg)({widthInt:W,heightInt:$,blurWidth:d,blurHeight:c,blurDataURL:P||"",objectFit:K.objectFit})+'")':'url("'+I+'")',V=a.includes(K.objectFit)?"fill"===K.objectFit?"100% 100%":"cover":K.objectFit,X=J?{backgroundSize:V,backgroundPosition:K.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:J}:{},Y=function(t){let{config:e,src:i,unoptimized:r,width:s,quality:a,sizes:n,loader:o}=t;if(r)return{src:i,srcSet:void 0,sizes:void 0};let{widths:h,kind:l}=function(t,e,i){let{deviceSizes:r,allSizes:s}=t;if(i){let t=/(^|\s)(1?\d?\d)vw/g,e=[];for(let r;r=t.exec(i);)e.push(parseInt(r[2]));if(e.length){let t=.01*Math.min(...e);return{widths:s.filter(e=>e>=r[0]*t),kind:"w"}}return{widths:s,kind:"w"}}return"number"!=typeof e?{widths:r,kind:"w"}:{widths:[...new Set([e,2*e].map(t=>s.find(e=>e>=t)||s[s.length-1]))],kind:"x"}}(e,s,n),d=h.length-1;return{sizes:n||"w"!==l?n:"100vw",srcSet:h.map((t,r)=>o({config:e,src:i,quality:a,width:t})+" "+("w"===l?t:r+1)+l).join(", "),src:o({config:e,src:i,quality:a,width:h[d]})}}({config:l,src:u,unoptimized:p,width:W,quality:q,sizes:f,loader:N});return{props:{...O,loading:Z?"lazy":g,fetchPriority:v,width:W,height:$,decoding:C,className:y,style:{...K,...X},sizes:Y.sizes,srcSet:Y.srcSet,src:b||Y.src},meta:{unoptimized:p,priority:_,placeholder:I,fill:E}}}},5239:(t,e,i)=>{"use strict";i.d(e,{default:()=>s.a});var r=i(4652),s=i.n(r)},6724:(t,e,i)=>{"use strict";i.d(e,{gl:()=>g,oK:()=>a});class r extends Error{}var s=i(1210);class a{constructor(t,e=!1,i=!0){this.device=t,this.tracing=e,this.slipReaderEnabled=!1,this.baudrate=0,this.traceLog="",this.lastTraceTime=Date.now(),this.buffer=new Uint8Array(0),this.SLIP_END=192,this.SLIP_ESC=219,this.SLIP_ESC_END=220,this.SLIP_ESC_ESC=221,this._DTR_state=!1,this.slipReaderEnabled=i}getInfo(){let t=this.device.getInfo();return t.usbVendorId&&t.usbProductId?`WebSerial VendorID 0x${t.usbVendorId.toString(16)} ProductID 0x${t.usbProductId.toString(16)}`:""}getPid(){return this.device.getInfo().usbProductId}trace(t){let e=Date.now()-this.lastTraceTime,i=`TRACE ${e.toFixed(3)}`,r=`${i} ${t}`;console.log(r),this.traceLog+=r+"\n"}async returnTrace(){try{await navigator.clipboard.writeText(this.traceLog),console.log("Text copied to clipboard!")}catch(t){console.error("Failed to copy text:",t)}}hexify(t){return Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("").padEnd(16," ")}hexConvert(t,e=!0){if(!e||!(t.length>16))return this.hexify(t);{let e="",i=t;for(;i.length>0;){let t=i.slice(0,16),r=String.fromCharCode(...t).split("").map(t=>" "===t||t>=" "&&t<="~"&&"  "!==t?t:".").join("");i=i.slice(16),e+=`
    ${this.hexify(t.slice(0,8))} ${this.hexify(t.slice(8))} | ${r}`}return e}}slipWriter(t){let e=[];e.push(192);for(let i=0;i<t.length;i++)219===t[i]?e.push(219,221):192===t[i]?e.push(219,220):e.push(t[i]);return e.push(192),new Uint8Array(e)}async write(t){let e=this.slipWriter(t);if(this.device.writable){let t=this.device.writable.getWriter();this.tracing&&(console.log("Write bytes"),this.trace(`Write ${e.length} bytes: ${this.hexConvert(e)}`)),await t.write(e),t.releaseLock()}}appendArray(t,e){let i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}async *readLoop(t){if(this.reader)try{for(;;){let e=new Promise((e,i)=>setTimeout(()=>i(Error("Read timeout exceeded")),t)),i=await Promise.race([this.reader.read(),e]);if(null===i)break;let{value:r,done:s}=i;if(s||!r)break;yield r}}catch(t){console.error("Error reading from serial port:",t)}finally{this.buffer=new Uint8Array(0)}}async newRead(t,e){if(this.buffer.length>=t){let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}for(;this.buffer.length<t;){let t=this.readLoop(e),{value:i,done:r}=await t.next();if(r||!i)break;this.buffer=this.appendArray(this.buffer,i)}let i=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),i}async flushInput(){var t;this.reader&&!await this.reader.closed&&(await this.reader.cancel(),this.reader.releaseLock(),this.reader=null==(t=this.device.readable)?void 0:t.getReader())}async flushOutput(){var t,e;this.buffer=new Uint8Array(0),await (null==(t=this.device.writable)?void 0:t.getWriter().close()),null==(e=this.device.writable)||e.getWriter().releaseLock()}inWaiting(){return this.buffer.length}detectPanicHandler(t){let e=new TextDecoder("utf-8").decode(t),i=e.match(/G?uru Meditation Error: (?:Core \d panic'ed \(([a-zA-Z ]*)\))?/)||e.match(/F?atal exception \(\d+\): (?:([a-zA-Z ]*)?.*epc)?/);if(i){let t=i[1]||i[2];throw Error(`Guru Meditation Error detected${t?` (${t})`:""}`)}}async *read(t){var e;this.reader||(this.reader=null==(e=this.device.readable)?void 0:e.getReader());let i=null,r=!1,s=!1;for(;;){let e=this.inWaiting(),a=await this.newRead(e>0?e:1,t);if(!a||0===a.length){let t=null===i?s?"Serial data stream stopped: Possible serial noise or corruption.":"No serial data received.":"Packet content transfer stopped";throw this.trace(t),Error(t)}this.trace(`Read ${a.length} bytes: ${this.hexConvert(a)}`);let n=0;for(;n<a.length;){let e=a[n++];if(null===i)if(e===this.SLIP_END)i=new Uint8Array(0);else{this.trace(`Read invalid data: ${this.hexConvert(a)}`);let i=await this.newRead(this.inWaiting(),t);throw this.trace(`Remaining data in serial buffer: ${this.hexConvert(i)}`),this.detectPanicHandler(new Uint8Array([...a,...i||[]])),Error(`Invalid head of packet (0x${e.toString(16)}): Possible serial noise or corruption.`)}else if(r)if(r=!1,e===this.SLIP_ESC_END)i=this.appendArray(i,new Uint8Array([this.SLIP_END]));else if(e===this.SLIP_ESC_ESC)i=this.appendArray(i,new Uint8Array([this.SLIP_ESC]));else{this.trace(`Read invalid data: ${this.hexConvert(a)}`);let i=await this.newRead(this.inWaiting(),t);throw this.trace(`Remaining data in serial buffer: ${this.hexConvert(i)}`),this.detectPanicHandler(new Uint8Array([...a,...i||[]])),Error(`Invalid SLIP escape (0xdb, 0x${e.toString(16)})`)}else e===this.SLIP_ESC?r=!0:e===this.SLIP_END?(this.trace(`Received full packet: ${this.hexConvert(i)}`),this.buffer=this.appendArray(this.buffer,a.slice(n)),yield i,i=null,s=!0):i=this.appendArray(i,new Uint8Array([e]))}}}async *rawRead(){if(this.reader)try{for(;;){let{value:t,done:e}=await this.reader.read();if(e||!t)break;this.tracing&&(console.log("Raw Read bytes"),this.trace(`Read ${t.length} bytes: ${this.hexConvert(t)}`)),yield t}}catch(t){console.error("Error reading from serial port:",t)}finally{this.buffer=new Uint8Array(0)}}async setRTS(t){await this.device.setSignals({requestToSend:t}),await this.setDTR(this._DTR_state)}async setDTR(t){this._DTR_state=t,await this.device.setSignals({dataTerminalReady:t})}async connect(t=115200,e={}){var i;await this.device.open({baudRate:t,dataBits:null==e?void 0:e.dataBits,stopBits:null==e?void 0:e.stopBits,bufferSize:null==e?void 0:e.bufferSize,parity:null==e?void 0:e.parity,flowControl:null==e?void 0:e.flowControl}),this.baudrate=t,this.reader=null==(i=this.device.readable)?void 0:i.getReader()}async sleep(t){return new Promise(e=>setTimeout(e,t))}async waitForUnlock(t){for(;this.device.readable&&this.device.readable.locked||this.device.writable&&this.device.writable.locked;)await this.sleep(t)}async disconnect(){var t,e;(null==(t=this.device.readable)?void 0:t.locked)&&await (null==(e=this.reader)?void 0:e.cancel()),await this.waitForUnlock(400),await this.device.close(),this.reader=void 0}}function n(t){return new Promise(e=>setTimeout(e,t))}class o{constructor(t,e){this.resetDelay=e,this.transport=t}async reset(){await this.transport.setDTR(!1),await this.transport.setRTS(!0),await n(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await n(this.resetDelay),await this.transport.setDTR(!1)}}class h{constructor(t){this.transport=t}async reset(){await this.transport.setRTS(!1),await this.transport.setDTR(!1),await n(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await n(100),await this.transport.setRTS(!0),await this.transport.setDTR(!1),await this.transport.setRTS(!0),await n(100),await this.transport.setRTS(!1),await this.transport.setDTR(!1)}}class l{constructor(t,e=!1){this.transport=t,this.usingUsbOtg=e,this.transport=t}async reset(){this.usingUsbOtg?(await n(200),await this.transport.setRTS(!1),await n(200)):(await n(100),await this.transport.setRTS(!1))}}class d{constructor(t,e){this.transport=t,this.sequenceString=e,this.transport=t}async reset(){let t={D:async t=>await this.transport.setDTR(t),R:async t=>await this.transport.setRTS(t),W:async t=>await n(t)};try{if(!function(t){let e=["D","R","W"];for(let i of t.split("|")){let t=i[0],r=i.slice(1);if(!e.includes(t))return!1;if("D"===t||"R"===t){if("0"!==r&&"1"!==r)return!1}else if("W"===t){let t=parseInt(r);if(isNaN(t)||t<=0)return!1}}return!0}(this.sequenceString))return;for(let e of this.sequenceString.split("|")){let i=e[0],r=e.slice(1);"W"===i?await t.W(Number(r)):("D"===i||"R"===i)&&await t[i]("1"===r)}}catch(t){throw Error("Invalid custom reset sequence")}}}var c=i(8149),u=i.n(c);async function f(t){let e;switch(t){case"ESP32":e=await i.e(821).then(i.t.bind(i,8821,19));break;case"ESP32-C2":e=await i.e(448).then(i.t.bind(i,3448,19));break;case"ESP32-C3":e=await i.e(223).then(i.t.bind(i,4223,19));break;case"ESP32-C5":e=await i.e(209).then(i.t.bind(i,5209,19));break;case"ESP32-C6":e=await i.e(687).then(i.t.bind(i,6068,19));break;case"ESP32-C61":e=await i.e(233).then(i.t.bind(i,1233,19));break;case"ESP32-H2":e=await i.e(79).then(i.t.bind(i,8079,19));break;case"ESP32-P4":e=await i.e(329).then(i.t.bind(i,9329,19));break;case"ESP32-S2":e=await i.e(256).then(i.t.bind(i,7256,19));break;case"ESP32-S3":e=await i.e(455).then(i.t.bind(i,5836,19));break;case"ESP8266":e=await i.e(562).then(i.t.bind(i,8562,19))}if(e)return{bss_start:e.bss_start,data:e.data,data_start:e.data_start,entry:e.entry,text:e.text,text_start:e.text_start,decodedData:p(e.data),decodedText:p(e.text)}}function p(t){return new Uint8Array(u()(t).split("").map(function(t){return t.charCodeAt(0)}))}async function _(t){switch(t){case 0xf01d83:{let{ESP32ROM:t}=await i.e(965).then(i.bind(i,5965));return new t}case 0xc21e06f:case 0x6f51306f:case 0x7c41a06f:{let{ESP32C2ROM:t}=await i.e(300).then(i.bind(i,9300));return new t}case 0x6921506f:case 0x1b31506f:case 0x4881606f:case 0x4361606f:{let{ESP32C3ROM:t}=await i.e(31).then(i.bind(i,7031));return new t}case 0x2ce0806f:{let{ESP32C6ROM:t}=await i.e(968).then(i.bind(i,7968));return new t}case 0x2421606f:case 0x33f0206f:case 0x4f81606f:{let{ESP32C61ROM:t}=await i.e(495).then(i.bind(i,7495));return new t}case 0x1101406f:case 0x63e1406f:case 0x5fd1406f:{let{ESP32C5ROM:t}=await i.e(609).then(i.bind(i,5609));return new t}case 0xd7b73e80:case 0x97e30068:{let{ESP32H2ROM:t}=await i.e(175).then(i.bind(i,9175));return new t}case 9:{let{ESP32S3ROM:t}=await i.e(471).then(i.bind(i,471));return new t}case 1990:{let{ESP32S2ROM:t}=await i.e(316).then(i.bind(i,9316));return new t}case 0xfff0c101:{let{ESP8266ROM:t}=await i.e(538).then(i.bind(i,9538));return new t}case 0:case 0xaddbad0:case 0x7039ad9:{let{ESP32P4ROM:t}=await i.e(665).then(i.bind(i,46));return new t}default:return null}}class g{constructor(t){var e,i,r,s,n,c,u,f;this.ESP_RAM_BLOCK=6144,this.ESP_FLASH_BEGIN=2,this.ESP_FLASH_DATA=3,this.ESP_FLASH_END=4,this.ESP_MEM_BEGIN=5,this.ESP_MEM_END=6,this.ESP_MEM_DATA=7,this.ESP_WRITE_REG=9,this.ESP_READ_REG=10,this.ESP_SPI_ATTACH=13,this.ESP_CHANGE_BAUDRATE=15,this.ESP_FLASH_DEFL_BEGIN=16,this.ESP_FLASH_DEFL_DATA=17,this.ESP_FLASH_DEFL_END=18,this.ESP_SPI_FLASH_MD5=19,this.ESP_ERASE_FLASH=208,this.ESP_ERASE_REGION=209,this.ESP_READ_FLASH=210,this.ESP_RUN_USER_CODE=211,this.ESP_IMAGE_MAGIC=233,this.ESP_CHECKSUM_MAGIC=239,this.ROM_INVALID_RECV_MSG=5,this.DEFAULT_TIMEOUT=3e3,this.ERASE_REGION_TIMEOUT_PER_MB=3e4,this.ERASE_WRITE_TIMEOUT_PER_MB=4e4,this.MD5_TIMEOUT_PER_MB=8e3,this.CHIP_ERASE_TIMEOUT=12e4,this.FLASH_READ_TIMEOUT=1e5,this.MAX_TIMEOUT=2*this.CHIP_ERASE_TIMEOUT,this.CHIP_DETECT_MAGIC_REG_ADDR=0x40001000,this.DETECTED_FLASH_SIZES={18:"256KB",19:"512KB",20:"1MB",21:"2MB",22:"4MB",23:"8MB",24:"16MB"},this.DETECTED_FLASH_SIZES_NUM={18:256,19:512,20:1024,21:2048,22:4096,23:8192,24:16384},this.USB_JTAG_SERIAL_PID=4097,this.romBaudrate=115200,this.debugLogging=!1,this.syncStubDetected=!1,this.flashSizeBytes=function(t){let e=-1;return -1!==t.indexOf("KB")?e=1024*parseInt(t.slice(0,t.indexOf("KB"))):-1!==t.indexOf("MB")&&(e=1024*parseInt(t.slice(0,t.indexOf("MB")))*1024),e},this.IS_STUB=!1,this.FLASH_WRITE_SIZE=16384,this.transport=t.transport,this.baudrate=t.baudrate,this.resetConstructors={classicReset:(t,e)=>new o(t,e),customReset:(t,e)=>new d(t,e),hardReset:(t,e)=>new l(t,e),usbJTAGSerialReset:t=>new h(t)},t.serialOptions&&(this.serialOptions=t.serialOptions),t.romBaudrate&&(this.romBaudrate=t.romBaudrate),t.terminal&&(this.terminal=t.terminal,this.terminal.clean()),void 0!==t.debugLogging&&(this.debugLogging=t.debugLogging),t.port&&(this.transport=new a(t.port)),void 0!==t.enableTracing&&(this.transport.tracing=t.enableTracing),(null==(e=t.resetConstructors)?void 0:e.classicReset)&&(this.resetConstructors.classicReset=null==(i=t.resetConstructors)?void 0:i.classicReset),(null==(r=t.resetConstructors)?void 0:r.customReset)&&(this.resetConstructors.customReset=null==(s=t.resetConstructors)?void 0:s.customReset),(null==(n=t.resetConstructors)?void 0:n.hardReset)&&(this.resetConstructors.hardReset=null==(c=t.resetConstructors)?void 0:c.hardReset),(null==(u=t.resetConstructors)?void 0:u.usbJTAGSerialReset)&&(this.resetConstructors.usbJTAGSerialReset=null==(f=t.resetConstructors)?void 0:f.usbJTAGSerialReset),this.info("esptool.js"),this.info("Serial port "+this.transport.getInfo())}_sleep(t){return new Promise(e=>setTimeout(e,t))}write(t,e=!0){this.terminal?e?this.terminal.writeLine(t):this.terminal.write(t):console.log(t)}error(t,e=!0){this.write(`Error: ${t}`,e)}info(t,e=!0){this.write(t,e)}debug(t,e=!0){this.debugLogging&&this.write(`Debug: ${t}`,e)}_shortToBytearray(t){return new Uint8Array([255&t,t>>8&255])}_intToByteArray(t){return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}_byteArrayToShort(t,e){return t|e>>8}_byteArrayToInt(t,e,i,r){return t|e<<8|i<<16|r<<24}_appendBuffer(t,e){let i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}_appendArray(t,e){let i=new Uint8Array(t.length+e.length);return i.set(t,0),i.set(e,t.length),i}ui8ToBstr(t){let e="";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e}bstrToUi8(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}async flushInput(){try{await this.transport.flushInput()}catch(t){this.error(t.message)}}async readPacket(t=null,e=this.DEFAULT_TIMEOUT){for(let i=0;i<100;i++){let{value:i}=await this.transport.read(e).next();if(!i||i.length<8)continue;let s=i[0];if(1!==s)continue;let a=i[1],n=this._byteArrayToInt(i[4],i[5],i[6],i[7]),o=i.slice(8);if(1==s){if(null==t||a==t)return[n,o];else if(0!=o[0]&&o[1]==this.ROM_INVALID_RECV_MSG)throw await this.flushInput(),new r("unsupported command error")}}throw new r("invalid response")}async command(t=null,e=new Uint8Array(0),i=0,r=!0,s=this.DEFAULT_TIMEOUT){if(null!=t){let a;this.transport.tracing&&this.transport.trace(`command op:0x${t.toString(16).padStart(2,"0")} data len=${e.length} wait_response=${+!!r} timeout=${(s/1e3).toFixed(3)} data=${this.transport.hexConvert(e)}`);let n=new Uint8Array(8+e.length);for(a=0,n[0]=0,n[1]=t,n[2]=this._shortToBytearray(e.length)[0],n[3]=this._shortToBytearray(e.length)[1],n[4]=this._intToByteArray(i)[0],n[5]=this._intToByteArray(i)[1],n[6]=this._intToByteArray(i)[2],n[7]=this._intToByteArray(i)[3];a<e.length;a++)n[8+a]=e[a];await this.transport.write(n)}return r?this.readPacket(t,s):[0,new Uint8Array(0)]}async readReg(t,e=this.DEFAULT_TIMEOUT){let i=this._intToByteArray(t);return(await this.command(this.ESP_READ_REG,i,void 0,void 0,e))[0]}async writeReg(t,e,i=0xffffffff,r=0,s=0){let a=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));a=this._appendArray(a,this._intToByteArray(i)),a=this._appendArray(a,this._intToByteArray(r)),s>0&&(a=this._appendArray(a,this._intToByteArray(this.chip.UART_DATE_REG_ADDR)),a=this._appendArray(a,this._intToByteArray(0)),a=this._appendArray(a,this._intToByteArray(0)),a=this._appendArray(a,this._intToByteArray(s))),await this.checkCommand("write target memory",this.ESP_WRITE_REG,a)}async sync(){let t;this.debug("Sync");let e=new Uint8Array(36);for(t=0,e[0]=7,e[1]=7,e[2]=18,e[3]=32;t<32;t++)e[4+t]=85;try{let t=await this.command(8,e,void 0,void 0,100);this.syncStubDetected=0===t[0];for(let e=0;e<7;e++)t=await this.command(),this.syncStubDetected=this.syncStubDetected&&0===t[0];return t}catch(t){throw this.debug("Sync err "+t),t}}async _connectAttempt(t="default_reset",e){this.debug("_connect_attempt "+t),e&&await e.reset();let i=this.transport.inWaiting(),r=Array.from(await this.transport.newRead(i>0?i:1,this.DEFAULT_TIMEOUT),t=>String.fromCharCode(t)).join("").match(/boot:(0x[0-9a-fA-F]+)(.*waiting for download)?/),s=!1,a="",n=!1;r&&(s=!0,a=r[1],n=!!r[2]);let o="";for(let t=0;t<5;t++)try{this.debug(`Sync connect attempt ${t}`);let e=await this.sync();return this.debug(e[0].toString()),"success"}catch(t){this.debug(`Error at sync ${t}`),o=t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)}return s&&(o=`Wrong boot mode detected (${a}).
        This chip needs to be in download mode.`,n&&(o=`Download mode successfully detected, but getting no sync reply:
           The serial TX path seems to be down.`)),o}constructResetSequence(t){if("no_reset"!==t){if("usb_reset"===t||this.transport.getPid()===this.USB_JTAG_SERIAL_PID){if(this.resetConstructors.usbJTAGSerialReset)return this.debug("using USB JTAG Serial Reset"),[this.resetConstructors.usbJTAGSerialReset(this.transport)]}else if(this.resetConstructors.classicReset)return this.debug("using Classic Serial Reset"),[this.resetConstructors.classicReset(this.transport,50),this.resetConstructors.classicReset(this.transport,550)]}return[]}async connect(t="default_reset",e=7,i=!0){let s;this.info("Connecting...",!1),await this.transport.connect(this.romBaudrate,this.serialOptions);let a=this.constructResetSequence(t);for(let i=0;i<e;i++){let e=a.length>0?a[i%a.length]:null;if("success"===(s=await this._connectAttempt(t,e)))break}if("success"!==s)throw new r("Failed to connect with the device");if(this.debug("Connect attempt successful."),this.info("\n\r",!1),i){let t=await this.readReg(this.CHIP_DETECT_MAGIC_REG_ADDR)>>>0;this.debug("Chip Magic "+t.toString(16));let e=await _(t);if(null===this.chip)throw new r(`Unexpected CHIP magic value ${t}. Failed to autodetect chip type.`);this.chip=e}}async detectChip(t="default_reset"){await this.connect(t),this.info("Detecting chip type... ",!1),null!=this.chip?this.info(this.chip.CHIP_NAME):this.info("unknown!")}async checkCommand(t="",e=null,i=new Uint8Array(0),r=0,s=this.DEFAULT_TIMEOUT){this.debug("check_command "+t);let a=await this.command(e,i,r,void 0,s);return a[1].length>4?a[1]:a[0]}async memBegin(t,e,i,s){if(this.IS_STUB){let e=s+t,i=await f(this.chip.CHIP_NAME);if(i){for(let[t,a]of[[i.bss_start||i.data_start,i.data_start+i.decodedData.length],[i.text_start,i.text_start+i.decodedText.length]])if(s<a&&e>t)throw new r(`Software loader is resident at 0x${t.toString(16).padStart(8,"0")}-0x${a.toString(16).padStart(8,"0")}.
            Can't load binary at overlapping address range 0x${s.toString(16).padStart(8,"0")}-0x${e.toString(16).padStart(8,"0")}.
            Either change binary loading address, or use the no-stub option to disable the software loader.`)}}this.debug("mem_begin "+t+" "+e+" "+i+" "+s.toString(16));let a=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));a=this._appendArray(a,this._intToByteArray(i)),a=this._appendArray(a,this._intToByteArray(s)),await this.checkCommand("enter RAM download mode",this.ESP_MEM_BEGIN,a)}checksum(t,e=this.ESP_CHECKSUM_MAGIC){for(let i=0;i<t.length;i++)e^=t[i];return e}async memBlock(t,e){let i=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));i=this._appendArray(i,this._intToByteArray(0)),i=this._appendArray(i,this._intToByteArray(0)),i=this._appendArray(i,t);let r=this.checksum(t);await this.checkCommand("write to target RAM",this.ESP_MEM_DATA,i,r)}async memFinish(t){let e=this._appendArray(this._intToByteArray(+(0===t)),this._intToByteArray(t));await this.checkCommand("leave RAM download mode",this.ESP_MEM_END,e,void 0,200)}async flashSpiAttach(t){let e=this._intToByteArray(t);await this.checkCommand("configure SPI flash pins",this.ESP_SPI_ATTACH,e)}timeoutPerMb(t,e){let i=e/1e6*t;return i<3e3?3e3:i}async flashBegin(t,e){let i=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),r=this.chip.getEraseSize(e,t),s=new Date,a=s.getTime(),n=3e3;!1==this.IS_STUB&&(n=this.timeoutPerMb(this.ERASE_REGION_TIMEOUT_PER_MB,t)),this.debug("flash begin "+r+" "+i+" "+this.FLASH_WRITE_SIZE+" "+e+" "+t);let o=this._appendArray(this._intToByteArray(r),this._intToByteArray(i));o=this._appendArray(o,this._intToByteArray(this.FLASH_WRITE_SIZE)),o=this._appendArray(o,this._intToByteArray(e)),!1==this.IS_STUB&&(o=this._appendArray(o,this._intToByteArray(0))),await this.checkCommand("enter Flash download mode",this.ESP_FLASH_BEGIN,o,void 0,n);let h=s.getTime();return 0!=t&&!1==this.IS_STUB&&this.info("Took "+(h-a)/1e3+"."+(h-a)%1e3+"s to erase flash block"),i}async flashDeflBegin(t,e,i){let r,s,a=Math.floor((e+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),n=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),o=new Date,h=o.getTime();this.IS_STUB?(r=t,s=this.DEFAULT_TIMEOUT):(r=n*this.FLASH_WRITE_SIZE,s=this.timeoutPerMb(this.ERASE_REGION_TIMEOUT_PER_MB,r)),this.info("Compressed "+t+" bytes to "+e+"...");let l=this._appendArray(this._intToByteArray(r),this._intToByteArray(a));l=this._appendArray(l,this._intToByteArray(this.FLASH_WRITE_SIZE)),l=this._appendArray(l,this._intToByteArray(i)),("ESP32-S2"===this.chip.CHIP_NAME||"ESP32-S3"===this.chip.CHIP_NAME||"ESP32-C3"===this.chip.CHIP_NAME||"ESP32-C2"===this.chip.CHIP_NAME)&&!1===this.IS_STUB&&(l=this._appendArray(l,this._intToByteArray(0))),await this.checkCommand("enter compressed flash mode",this.ESP_FLASH_DEFL_BEGIN,l,void 0,s);let d=o.getTime();return 0!=t&&!1===this.IS_STUB&&this.info("Took "+(d-h)/1e3+"."+(d-h)%1e3+"s to erase flash block"),a}async flashBlock(t,e,i){let r=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,t);let s=this.checksum(t);await this.checkCommand("write to target Flash after seq "+e,this.ESP_FLASH_DATA,r,s,i)}async flashDeflBlock(t,e,i){let r=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,t);let s=this.checksum(t);this.debug("flash_defl_block "+t[0].toString(16)+" "+t[1].toString(16)),await this.checkCommand("write compressed data to flash after seq "+e,this.ESP_FLASH_DEFL_DATA,r,s,i)}async flashFinish(t=!1){let e=this._intToByteArray(+!t);await this.checkCommand("leave Flash mode",this.ESP_FLASH_END,e)}async flashDeflFinish(t=!1){let e=this._intToByteArray(+!t);await this.checkCommand("leave compressed flash mode",this.ESP_FLASH_DEFL_END,e)}async runSpiflashCommand(t,e,i){let s,a,n=this.chip.SPI_REG_BASE,o=n+0,h=n+this.chip.SPI_USR_OFFS,l=n+this.chip.SPI_USR1_OFFS,d=n+this.chip.SPI_USR2_OFFS,c=n+this.chip.SPI_W0_OFFS;if(s=null!=this.chip.SPI_MOSI_DLEN_OFFS?async(t,e)=>{let i=n+this.chip.SPI_MOSI_DLEN_OFFS,r=n+this.chip.SPI_MISO_DLEN_OFFS;t>0&&await this.writeReg(i,t-1),e>0&&await this.writeReg(r,e-1)}:async(t,e)=>{await this.writeReg(l,(0===e?0:e-1)<<8|(0===t?0:t-1)<<17)},i>32)throw new r("Reading more than 32 bits back from a SPI flash operation is unsupported");if(e.length>64)throw new r("Writing more than 64 bytes of data with one SPI command is unsupported");let u=8*e.length,f=await this.readReg(h),p=await this.readReg(d),_=-0x80000000;i>0&&(_|=0x10000000),u>0&&(_|=0x8000000),await s(u,i),await this.writeReg(h,_);let g=0x70000000|t;if(await this.writeReg(d,g),0==u)await this.writeReg(c,0);else{if(e.length%4!=0){let t=new Uint8Array(e.length%4);e=this._appendArray(e,t)}let t=c;for(a=0;a<e.length-4;a+=4)g=this._byteArrayToInt(e[a],e[a+1],e[a+2],e[a+3]),await this.writeReg(t,g),t+=4}for(await this.writeReg(o,262144),a=0;a<10&&0!=(g=await this.readReg(o)&262144);a++);if(10===a)throw new r("SPI command did not complete in time");let y=await this.readReg(c);return await this.writeReg(h,f),await this.writeReg(d,p),y}async readFlashId(){let t=new Uint8Array(0);return await this.runSpiflashCommand(159,t,24)}async eraseFlash(){this.info("Erasing flash (this may take a while)...");let t=new Date,e=t.getTime(),i=await this.checkCommand("erase flash",this.ESP_ERASE_FLASH,void 0,void 0,this.CHIP_ERASE_TIMEOUT),r=(t=new Date).getTime();return this.info("Chip erase completed successfully in "+(r-e)/1e3+"s"),i}toHex(t){return Array.prototype.map.call(t,t=>("00"+t.toString(16)).slice(-2)).join("")}async flashMd5sum(t,e){let i=this.timeoutPerMb(this.MD5_TIMEOUT_PER_MB,e),r=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0));let s=await this.checkCommand("calculate md5sum",this.ESP_SPI_FLASH_MD5,r,void 0,i);return s instanceof Uint8Array&&s.length>16&&(s=s.slice(0,16)),this.toHex(s)}async readFlash(t,e,i=null){let s=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));s=this._appendArray(s,this._intToByteArray(4096)),s=this._appendArray(s,this._intToByteArray(1024));let a=await this.checkCommand("read flash",this.ESP_READ_FLASH,s);if(0!=a)throw new r("Failed to read memory: "+a);let n=new Uint8Array(0);for(;n.length<e;){let{value:t}=await this.transport.read(this.FLASH_READ_TIMEOUT).next();if(t instanceof Uint8Array)t.length>0&&(n=this._appendArray(n,t),await this.transport.write(this._intToByteArray(n.length)),i&&i(t,n.length,e));else throw new r("Failed to read memory: "+t)}return n}async runStub(){if(this.syncStubDetected)return this.info("Stub is already running. No upload is necessary."),this.chip;this.info("Uploading stub...");let t=await f(this.chip.CHIP_NAME);if(void 0===t)throw this.debug("Error loading Stub json"),Error("Error loading Stub json");let e=[t.decodedText,t.decodedData];for(let i=0;i<e.length;i++)if(e[i]){let r=0===i?t.text_start:t.data_start,s=e[i].length,a=Math.floor((s+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);await this.memBegin(s,a,this.ESP_RAM_BLOCK,r);for(let t=0;t<a;t++){let r=t*this.ESP_RAM_BLOCK,s=r+this.ESP_RAM_BLOCK;await this.memBlock(e[i].slice(r,s),t)}}this.info("Running stub..."),await this.memFinish(t.entry);let{value:i}=await this.transport.read(this.DEFAULT_TIMEOUT).next(),s=String.fromCharCode(...i);if("OHAI"!==s)throw new r(`Failed to start stub. Unexpected response ${s}`);return this.info("Stub running..."),this.IS_STUB=!0,this.chip}async changeBaud(){this.info("Changing baudrate to "+this.baudrate);let t=this.IS_STUB?this.romBaudrate:0,e=this._appendArray(this._intToByteArray(this.baudrate),this._intToByteArray(t));await this.command(this.ESP_CHANGE_BAUDRATE,e),this.info("Changed"),await this.transport.disconnect(),await this._sleep(50),await this.transport.connect(this.baudrate,this.serialOptions)}async main(t="default_reset"){await this.detectChip(t);let e=await this.chip.getChipDescription(this);return this.info("Chip is "+e),this.info("Features: "+await this.chip.getChipFeatures(this)),this.info("Crystal is "+await this.chip.getCrystalFreq(this)+"MHz"),this.info("MAC: "+await this.chip.readMac(this)),await this.chip.readMac(this),void 0!==this.chip.postConnect&&await this.chip.postConnect(this),await this.runStub(),this.romBaudrate!==this.baudrate&&await this.changeBaud(),e}parseFlashSizeArg(t){if(void 0===this.chip.FLASH_SIZES[t])throw new r("Flash size "+t+" is not supported by this chip type. Supported sizes: "+this.chip.FLASH_SIZES);return this.chip.FLASH_SIZES[t]}_updateImageFlashParams(t,e,i,r,s){if(this.debug("_update_image_flash_params "+i+" "+r+" "+s),t.length<8||e!=this.chip.BOOTLOADER_FLASH_OFFSET)return t;if("keep"===i&&"keep"===r&&"keep"===s)return this.info("Not changing the image"),t;let a=parseInt(t[0]),n=parseInt(t[2]),o=parseInt(t[3]);if(a!==this.ESP_IMAGE_MAGIC)return this.info("Warning: Image file at 0x"+e.toString(16)+" doesn't look like an image file, so not changing any flash settings."),t;"keep"!==r&&(n=({qio:0,qout:1,dio:2,dout:3})[r]);let h=15&o;"keep"!==s&&(h=({"40m":0,"26m":1,"20m":2,"80m":15})[s]);let l=240&o;"keep"!==i&&(l=this.parseFlashSizeArg(i));let d=n<<8|h+l;return this.info("Flash params set to "+d.toString(16)),parseInt(t[2])!==n<<8&&(t=t.substring(0,2)+(n<<8).toString()+t.substring(3)),parseInt(t[3])!==h+l&&(t=t.substring(0,3)+(h+l).toString()+t.substring(4)),t}async writeFlash(t){let e,i;if(this.debug("EspLoader program"),"keep"!==t.flashSize){let e=this.flashSizeBytes(t.flashSize);for(let i=0;i<t.fileArray.length;i++)if(t.fileArray[i].data.length+t.fileArray[i].address>e)throw new r(`File ${i+1} doesn't fit in the available flash`)}!0===this.IS_STUB&&!0===t.eraseAll&&await this.eraseFlash();for(let a=0;a<t.fileArray.length;a++){let n;if(this.debug("Data Length "+t.fileArray[a].data.length),e=t.fileArray[a].data,this.debug("Image Length "+e.length),0===e.length){this.debug("Warning: File is empty");continue}e=this.ui8ToBstr(function(t,e,i=255){let r=t.length%4;if(0!==r){let e=new Uint8Array(4-r).fill(i),s=new Uint8Array(t.length+e.length);return s.set(t),s.set(e,t.length),s}return t}(this.bstrToUi8(e),4)),i=t.fileArray[a].address,e=this._updateImageFlashParams(e,i,t.flashSize,t.flashMode,t.flashFreq);let o=null;t.calculateMD5Hash&&(o=t.calculateMD5Hash(e),this.debug("Image MD5 "+o));let h=e.length;if(t.compress){let t=this.bstrToUi8(e);e=this.ui8ToBstr((0,s.Kc)(t,{level:9})),n=await this.flashDeflBegin(h,e.length,i)}else n=await this.flashBegin(h,i);let l=0,d=0,c=e.length;t.reportProgress&&t.reportProgress(a,0,c);let u=new Date,f=u.getTime(),p=5e3,_=new s.EL({chunkSize:1}),g=0;for(_.onData=function(t){g+=t.byteLength};e.length>0;){this.debug("Write loop "+i+" "+l+" "+n),this.info("Writing at 0x"+(i+g).toString(16)+"... ("+Math.floor(100*(l+1)/n)+"%)");let s=this.bstrToUi8(e.slice(0,this.FLASH_WRITE_SIZE));if(t.compress){let t=g;_.push(s,!1);let e=g-t,i=3e3;this.timeoutPerMb(this.ERASE_WRITE_TIMEOUT_PER_MB,e)>3e3&&(i=this.timeoutPerMb(this.ERASE_WRITE_TIMEOUT_PER_MB,e)),!1===this.IS_STUB&&(p=i),await this.flashDeflBlock(s,l,p),this.IS_STUB&&(p=i)}else throw new r("Yet to handle Non Compressed writes");d+=s.length,e=e.slice(this.FLASH_WRITE_SIZE,e.length),l++,t.reportProgress&&t.reportProgress(a,d,c)}this.IS_STUB&&await this.readReg(this.CHIP_DETECT_MAGIC_REG_ADDR,p);let y=(u=new Date).getTime()-f;if(t.compress&&this.info("Wrote "+h+" bytes ("+d+" compressed) at 0x"+i.toString(16)+" in "+y/1e3+" seconds."),o){let t=await this.flashMd5sum(i,h);if(new String(t).valueOf()!=new String(o).valueOf())throw this.info("File  md5: "+o),this.info("Flash md5: "+t),new r("MD5 of file does not match data in flash!");this.info("Hash of data verified.")}}this.info("Leaving..."),this.IS_STUB&&(await this.flashBegin(0,0),t.compress?await this.flashDeflFinish():await this.flashFinish())}async flashId(){this.debug("flash_id");let t=await this.readFlashId();this.info("Manufacturer: "+(255&t).toString(16));let e=t>>16&255;this.info("Device: "+(t>>8&255).toString(16)+e.toString(16)),this.info("Detected flash size: "+this.DETECTED_FLASH_SIZES[e])}async getFlashSize(){this.debug("flash_id");let t=await this.readFlashId();return this.DETECTED_FLASH_SIZES_NUM[t>>16&255]}async softReset(t){if(this.IS_STUB)if("ESP8266"!=this.chip.CHIP_NAME)throw new r("Soft resetting is currently only supported on ESP8266");else t?(await this.flashBegin(0,0),await this.flashFinish(!0)):await this.command(this.ESP_RUN_USER_CODE,void 0,void 0,!1);else t||(await this.flashBegin(0,0),await this.flashFinish(!1))}async after(t="hard_reset",e){switch(t){case"hard_reset":if(this.resetConstructors.hardReset){this.info("Hard resetting via RTS pin...");let t=this.resetConstructors.hardReset(this.transport,e);await t.reset()}break;case"soft_reset":this.info("Soft resetting..."),await this.softReset(!1);break;case"no_reset_stub":this.info("Staying in flasher stub.");break;default:this.info("Staying in bootloader."),this.IS_STUB&&this.softReset(!0)}}}},8149:t=>{t.exports=function(t){return atob(t)}},9862:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"RouterContext",{enumerable:!0,get:function(){return r}});let r=i(8140)._(i(2115)).default.createContext(null)}}]);